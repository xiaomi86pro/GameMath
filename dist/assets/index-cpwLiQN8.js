(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();const MAX_QUIZ_TIME_SECONDS=30*60,quizState={currentLevel:1,currentLevelName:"C·∫•p 1 (Ph·∫°m vi 0-9)",currentQuizType:"ADD_SUB",currentScore:0,currentQuestionNumber:0,currentQuestion:null,quizTimer:null,timeRemaining:MAX_QUIZ_TIME_SECONDS,startTime:0,TOTAL_QUIZ_QUESTIONS:20},MULT_DIV_FACTORS={1:[2,3],2:[4,5],3:[6,7],4:[8,9]},RELATIVE_DAY_OPTIONS={"H√¥m nay":0,"Ng√†y mai":1,"Ng√†y kia":2,"H√¥m qua":-1,"H√¥m kia":-2},QUESTION_TYPES_TIMO=["day-of-week","age-problem","queue-problem"],DAYS_OF_WEEK=["Ch·ªß Nh·∫≠t","Th·ª© Hai","Th·ª© Ba","Th·ª© T∆∞","Th·ª© NƒÉm","Th·ª© S√°u","Th·ª© B·∫£y"];function getRandomInt(e){return Math.floor(Math.random()*e)}function getMaxRange(e){return e===1?10:e===2?100:e===3?1e3:10}function generateBasicOpQuestion(e){let t,r,o,n,s;do t=getRandomInt(e)+1,r=getRandomInt(e)+1,o=Math.random()>.5?"+":"-",o==="+"?(n=t+r,s=`${t} + ${r} = ?`):(t<r&&([t,r]=[r,t]),n=t-r,s=`${t} - ${r} = ?`);while(n<0||n>=e*2);return{question:s,answer:String(n),type:"input"}}function generateMultDivQuestion(){const e=MULT_DIV_FACTORS[currentLevel],t=e[getRandomInt(e.length)],r=getRandomInt(10)+1;let o,n,s,i;return Math.random()>.5?(o=t,n=r,s=o*n,i=`${o} √ó ${n} = ?`):(n=t,s=r,o=n*s,i=`${o} √∑ ${n} = ?`),{question:i,answer:String(s),type:"input"}}function generateBalanceEquation(e){const t=getRandomInt(e)+1,r=getRandomInt(e)+1,o=t+r,n=getRandomInt(e)+1,s=o-n;if(s<=0||s>=e*2)return generateBalanceEquation(e);const i=`${n} + ? = ${t} + ${r}`,a=String(s);return{question:i,answer:a,type:"input"}}function generateFindXMultDivQuestion(){const e=MULT_DIV_FACTORS[currentLevel],t=e[getRandomInt(e.length)],r=getRandomInt(10)+1;let o,n,s,i;if(Math.random()<.5)n=t,s=r,o=n*s,Math.random()>.5?i=`${n} √ó ? = ${o}`:i=`? √ó ${n} = ${o}`;else{n=t,s=r,o=n*s;const a=getRandomInt(3);a===0?i=`? √∑ ${n} = ${s}`:a===1?(s=n,i=`${o} √∑ ? = ${r}`):i=`${o} √∑ ${n} = ?`}return{question:i,answer:String(s),type:"input"}}function generateFindXQuestion(e){let t,r,o,n,s;do if(t=getRandomInt(e)+1,o=Math.random()>.5?"+":"-",o==="+"){n=getRandomInt(e)+1;const i=t+n;s=`${t} + ? = ${i}`}else if(Math.random()>.5){const i=getRandomInt(t);n=t-i,s=`${t} - ? = ${i}`}else{r=getRandomInt(e)+1;const i=getRandomInt(e)+1;n=r+i,s=`? - ${r} = ${i}`}while(n<=0||n>=e*2);return{question:s,answer:String(n),type:"input"}}function generateSimpleExpression(e,t){let r,o,n,s;if(t==="MULT_DIV"){const a=MULT_DIV_FACTORS[currentLevel];let c=a[getRandomInt(a.length)],u=getRandomInt(10)+1;if(n=Math.random()>.5?"√ó":"√∑",n==="√ó")r=c,o=u,s=r*o;else{const l=c,d=u,p=l*d;Math.random()>.5?(r=p,o=l,s=d):(r=p,o=d,s=l)}}else r=getRandomInt(e)+1,o=getRandomInt(e)+1,n=Math.random()>.5?"+":"-",n==="-"&&r<o&&([r,o]=[o,r]),s=n==="+"?r+o:r-o;return{expression:`${r} ${n} ${o}`.replace("√ó","*").replace("√∑","/"),result:s}}function generateComparisonQuestion(level,quizType){const isMultDivLevel=quizType==="MULT_DIV",max=isMultDivLevel?10:level===1?15:level===2?100:500;let exp1=generateSimpleExpression(max,currentQuizType),exp2=generateSimpleExpression(max,currentQuizType);!isMultDivLevel&&Math.abs(exp1.result-exp2.result)>20&&exp1.result!==exp2.result&&(exp2=generateSimpleExpression(max,currentQuizType));let answer="";const val1=eval(exp1.expression),val2=eval(exp2.expression);return val1>val2?answer=">":val1<val2?answer="<":answer="=",{question:"Ch·ªçn d·∫•u so s√°nh ƒë√∫ng:",exp1:exp1.expression.replace("*","√ó").replace("/","√∑"),exp2:exp2.expression.replace("*","√ó").replace("/","√∑"),answer,result1:val1,result2:val2,type:"comparison"}}function generateEvenOddNumberQuestion(e){const t=[];for(;t.length<4;){const a=getRandomInt(10);t.includes(a)||t.push(a)}const n=getRandomInt(4);let s,i;if(n===0){s=`Cho 4 ch·ªØ s·ªë: <span class="text-blue-700 font-extrabold">${t.join(", ")}</span>.
             T·∫°o s·ªë <span class="text-red-600 font-extrabold">CH·∫¥N nh·ªè nh·∫•t</span> c√≥ th·ªÉ (d√πng h·∫øt 4 ch·ªØ s·ªë).`;const a=t.filter(l=>l%2===0);if(a.length===0)return generateEvenOddNumberQuestion();const c=Math.max(...a);i=t.filter(l=>l!==c).sort((l,d)=>l-d).join("")+c}else if(n===1){s=`Cho 4 ch·ªØ s·ªë: <span class="text-blue-700 font-extrabold">${t.join(", ")}</span>.
             T·∫°o s·ªë <span class="text-red-600 font-extrabold">CH·∫¥N l·ªõn nh·∫•t</span> c√≥ th·ªÉ (d√πng h·∫øt 4 ch·ªØ s·ªë).`;const a=t.filter(l=>l%2===0);if(a.length===0)return generateEvenOddNumberQuestion();const c=Math.min(...a);i=t.filter(l=>l!==c).sort((l,d)=>d-l).join("")+c}else if(n===2){s=`Cho 4 ch·ªØ s·ªë: <span class="text-blue-700 font-extrabold">${t.join(", ")}</span>.
             T·∫°o s·ªë <span class="text-red-600 font-extrabold">L·∫∫ nh·ªè nh·∫•t</span> c√≥ th·ªÉ (d√πng h·∫øt 4 ch·ªØ s·ªë).`;const a=t.filter(l=>l%2!==0);if(a.length===0)return generateEvenOddNumberQuestion();const c=Math.max(...a);i=t.filter(l=>l!==c).sort((l,d)=>l-d).join("")+c}else{s=`Cho 4 ch·ªØ s·ªë: <span class="text-blue-700 font-extrabold">${t.join(", ")}</span>.
             T·∫°o s·ªë <span class="text-red-600 font-extrabold">L·∫∫ l·ªõn nh·∫•t</span> c√≥ th·ªÉ (d√πng h·∫øt 4 ch·ªØ s·ªë).`;const a=t.filter(l=>l%2!==0);if(a.length===0)return generateEvenOddNumberQuestion();const c=Math.min(...a);i=t.filter(l=>l!==c).sort((l,d)=>d-l).join("")+c}return{question:s,answer:i,type:"input"}}function generateMaxMinTwoNumbers(e){const t=[];for(;t.length<4;){const u=getRandomInt(10);!t.includes(u)&&u!==0&&t.push(u)}const n=getRandomInt(4);let s,i;const a=[...t].sort((u,l)=>l-u),c=[...t].sort((u,l)=>u-l);if(n===0){const u=parseInt(a[0].toString()+a[1].toString()),l=parseInt(a[2].toString()+a[3].toString());i=String(u+l),s=`Cho 4 ch·ªØ s·ªë: <span class="text-blue-700 font-extrabold">${t.join(", ")}</span>. 
                 T·∫°o <span class="text-red-600 font-extrabold">2 s·ªë L·ªöN NH·∫§T</span> c√≥ th·ªÉ (m·ªói s·ªë 2 ch·ªØ s·ªë) r·ªìi t√≠nh <span class="text-red-600 font-extrabold">T·ªîNG</span>.`}else if(n===1){const u=parseInt(a[0].toString()+a[1].toString()),l=parseInt(a[2].toString()+a[3].toString());i=String(Math.abs(u-l)),s=`Cho 4 ch·ªØ s·ªë: <span class="text-blue-700 font-extrabold">${t.join(", ")}</span>. 
                 T·∫°o <span class="text-red-600 font-extrabold">2 s·ªë L·ªöN NH·∫§T</span> c√≥ th·ªÉ (m·ªói s·ªë 2 ch·ªØ s·ªë) r·ªìi t√≠nh <span class="text-red-600 font-extrabold">HI·ªÜU</span>.`}else if(n===2){const u=parseInt(c[0].toString()+c[1].toString()),l=parseInt(c[2].toString()+c[3].toString());i=String(u+l),s=`Cho 4 ch·ªØ s·ªë: <span class="text-blue-700 font-extrabold">${t.join(", ")}</span>. 
                 T·∫°o <span class="text-red-600 font-extrabold">2 s·ªë NH·ªé NH·∫§T</span> c√≥ th·ªÉ (m·ªói s·ªë 2 ch·ªØ s·ªë) r·ªìi t√≠nh <span class="text-red-600 font-extrabold">T·ªîNG</span>.`}else{const u=parseInt(c[0].toString()+c[1].toString()),l=parseInt(c[2].toString()+c[3].toString());i=String(Math.abs(u-l)),s=`Cho 4 ch·ªØ s·ªë: <span class="text-blue-700 font-extrabold">${t.join(", ")}</span>. 
                 T·∫°o <span class="text-red-600 font-extrabold">2 s·ªë NH·ªé NH·∫§T</span> c√≥ th·ªÉ (m·ªói s·ªë 2 ch·ªØ s·ªë) r·ªìi t√≠nh <span class="text-red-600 font-extrabold">HI·ªÜU</span>.`}return{question:s,answer:i,type:"input"}}function generateSequencePattern(){const e=[2,3,4,5],t=e[getRandomInt(e.length)],r=getRandomInt(2)+5,n=[getRandomInt(10)+1];for(let c=1;c<r;c++)n.push(n[c-1]+t);const s=String(n[r-1]);return{question:`T√¨m s·ªë ti·∫øp theo trong d√£y: <span class="text-blue-700 font-extrabold">${n.slice(0,-1).join(", ")}, ?</span>`,answer:s,type:"input"}}function generateShapePattern(){const e=["üîµ","üî∫","‚≠ê","üü•","üíö","üî∂"],t=getRandomInt(2)+3,r=[];for(let c=0;c<t;c++)r.push(e[c]);const o=getRandomInt(2)+2;let n=[];for(let c=0;c<o;c++)n=n.concat(r);const s=n[n.length-1];return{question:`T√¨m h√¨nh ti·∫øp theo trong d√£y: <span style="font-size: 2rem;">${n.slice(0,-1).join(" ")}, ?</span>`,answer:s,type:"multiple-choice",choices:r,special:"shape-pattern"}}function generateSequenceIncrement(){const e=getRandomInt(2)+6,r=[getRandomInt(5)+1];let o=1;for(let a=1;a<e;a++)r.push(r[a-1]+o),o++;const n=String(r[e-1]);return{question:`T√¨m s·ªë ti·∫øp theo trong d√£y (quy lu·∫≠t tƒÉng d·∫ßn): <span class="text-blue-700 font-extrabold">${r.slice(0,-1).join(", ")}, ?</span>`,answer:n,type:"input"}}function generateSortingQuestion(e){let r;e===1?r=100:e===2?r=500:r=1e3;const o=Math.random()>.5?"tƒÉng d·∫ßn":"gi·∫£m d·∫ßn",n=[];for(;n.length<5;){const u=getRandomInt(r)+1;n.includes(u)||n.push(u)}let s=[...n].sort((u,l)=>u-l);o==="gi·∫£m d·∫ßn"&&s.reverse();const i=s.join(",");return{question:`S·∫Øp x·∫øp c√°c s·ªë sau theo th·ª© t·ª± <span class="font-extrabold ${o==="tƒÉng d·∫ßn"?"text-blue-600":"text-red-600"}">${o}</span>:`,numbers:n,answer:i,direction:o,type:"sorting"}}function createClockSVG(e,t){const s=(e%12+t/60)*30-90,i=t*6-90;let a='<svg width="150" height="150" viewBox="0 0 150 150">';a+='<circle cx="75" cy="75" r="70" class="clock-face"/>';for(let c=1;c<=12;c++){const u=c*30*Math.PI/180,l=60,d=75+l*Math.cos(u-Math.PI/2),p=75+l*Math.sin(u-Math.PI/2);a+=`<text x="${d}" y="${p+5}" text-anchor="middle" font-size="12" fill="#374151">${c}</text>`}return a+=`<line x1="75" y1="75" x2="${75+40*Math.cos(s*Math.PI/180)}" y2="${75+40*Math.sin(s*Math.PI/180)}" class="hour-hand"/>`,a+=`<line x1="75" y1="75" x2="${75+60*Math.cos(i*Math.PI/180)}" y2="${75+60*Math.sin(i*Math.PI/180)}" class="minute-hand"/>`,a+='<circle cx="75" cy="75" r="3" fill="#ef4444"/>',a+="</svg>",a}function generateClockQuestion(){const e=getRandomInt(12)+1,t=getRandomInt(2)*30,r=String(e).padStart(2,"0"),o=String(t).padStart(2,"0"),n=`${r}:${o}`,s=createClockSVG(e,t);return{question:"ƒê·ªìng h·ªì n√†y ƒëang ch·ªâ m·∫•y gi·ªù?",answer:n,svg:s,type:"clock"}}function generateWordProblem(){const e=["+","-"],t=e[getRandomInt(e.length)];let o=getRandomInt(50)+5,n=getRandomInt(o/2)+2,s,i;return t==="+"?(i=o+n,s=`B·∫°n An c√≥ ${o} vi√™n k·∫πo. M·∫π cho An th√™m ${n} vi√™n k·∫πo n·ªØa. H·ªèi b·∫°n An c√≥ t·∫•t c·∫£ bao nhi√™u vi√™n k·∫πo?`):(i=o-n,s=`B·∫°n B√¨nh c√≥ ${o} qu·∫£ t√°o. B√¨nh cho b·∫°n ${n} qu·∫£. H·ªèi B√¨nh c√≤n l·∫°i bao nhi√™u qu·∫£ t√°o?`),{question:`**B√†i to√°n c√≥ l·ªùi vƒÉn:** ${s}`,answer:String(i),type:"input",special:"word-problem"}}function generateDayOfWeekQuestion(){const e=Object.keys(RELATIVE_DAY_OPTIONS),t=e[getRandomInt(e.length)],r=RELATIVE_DAY_OPTIONS[t],o=getRandomInt(7);DAYS_OF_WEEK[o];const n=(o+r+7)%7,s=DAYS_OF_WEEK[n],a=getRandomInt(5)+1,c=Math.random()>.5?"sau ƒë√≥":"tr∆∞·ªõc ƒë√≥",l=(c==="sau ƒë√≥"?"sau":"tr∆∞·ªõc")==="sau"?a:-a;let d=o+l;d=(d%7+7)%7;const p=DAYS_OF_WEEK[d];let m;if(t==="H√¥m nay")m=`<span class="text-purple-700 font-extrabold">${t}</span> l√† <span class="text-purple-700 font-extrabold">${s}</span>. H·ªèi <span class="font-extrabold">${a}</span> ng√†y <span class="text-red-600 font-extrabold">${c}</span> l√† th·ª© m·∫•y?`;else{const g=`<span class="text-purple-700 font-extrabold">${t}</span> l√† <span class="text-purple-700 font-extrabold">${s}</span>.`,f=`H·ªèi <span class="font-extrabold">${a}</span> ng√†y <span class="text-red-600 font-extrabold">${c}</span> (t√≠nh t·ª´ H√¥m nay) l√† th·ª© m·∫•y?`;m=`${g} H·ªèi H√¥m nay l√† th·ª© m·∫•y v√† ${f}`}return{question:m,answer:p,type:"multiple-choice",choices:DAYS_OF_WEEK,special:"day-of-week"}}function generateQueueProblem(){const e=["An","B√¨nh","Chi","Dung","Em","Phong","Giang","H√†","Linh","Mai"],t=e[getRandomInt(e.length)],r=getRandomInt(3);let o,n;if(r===0){const s=getRandomInt(15)+10;if((Math.random()>.5?"tr∆∞·ªõc":"sau")==="tr∆∞·ªõc"){const a=getRandomInt(s-2)+1,c=s-a-1,u=a+1;getRandomInt(2)===0?(o=`M·ªôt h√†ng c√≥ <span class="text-purple-700 font-extrabold">${s}</span> ng∆∞·ªùi. 
                         Ph√≠a <span class="text-red-600 font-extrabold">tr∆∞·ªõc</span> b·∫°n <span class="text-purple-700 font-extrabold">${t}</span> c√≥ 
                         <span class="text-purple-700 font-extrabold">${a}</span> ng∆∞·ªùi. 
                         H·ªèi ph√≠a <span class="text-red-600 font-extrabold">sau</span> b·∫°n ${t} c√≥ bao nhi√™u ng∆∞·ªùi?`,n=String(c)):(o=`M·ªôt h√†ng c√≥ <span class="text-purple-700 font-extrabold">${s}</span> ng∆∞·ªùi. 
                         Ph√≠a <span class="text-red-600 font-extrabold">tr∆∞·ªõc</span> b·∫°n <span class="text-purple-700 font-extrabold">${t}</span> c√≥ 
                         <span class="text-purple-700 font-extrabold">${a}</span> ng∆∞·ªùi. 
                         H·ªèi b·∫°n ${t} ƒë·ª©ng th·ª© m·∫•y?`,n=String(u))}else{const a=getRandomInt(s-2)+1,c=s-a-1,u=c+1;getRandomInt(2)===0?(o=`M·ªôt h√†ng c√≥ <span class="text-purple-700 font-extrabold">${s}</span> ng∆∞·ªùi. 
                         Ph√≠a <span class="text-red-600 font-extrabold">sau</span> b·∫°n <span class="text-purple-700 font-extrabold">${t}</span> c√≥ 
                         <span class="text-purple-700 font-extrabold">${a}</span> ng∆∞·ªùi. 
                         H·ªèi ph√≠a <span class="text-red-600 font-extrabold">tr∆∞·ªõc</span> b·∫°n ${t} c√≥ bao nhi√™u ng∆∞·ªùi?`,n=String(c)):(o=`M·ªôt h√†ng c√≥ <span class="text-purple-700 font-extrabold">${s}</span> ng∆∞·ªùi. 
                         Ph√≠a <span class="text-red-600 font-extrabold">sau</span> b·∫°n <span class="text-purple-700 font-extrabold">${t}</span> c√≥ 
                         <span class="text-purple-700 font-extrabold">${a}</span> ng∆∞·ªùi. 
                         H·ªèi b·∫°n ${t} ƒë·ª©ng th·ª© m·∫•y?`,n=String(u))}}else if(r===1){const s=getRandomInt(10)+11,i=s%2===0?s+1:s,a=Math.ceil(i/2);o=`M·ªôt h√†ng c√≥ <span class="text-purple-700 font-extrabold">${i}</span> ng∆∞·ªùi. 
                 B·∫°n <span class="text-purple-700 font-extrabold">${t}</span> ƒë·ª©ng ·ªü <span class="text-red-600 font-extrabold">gi·ªØa h√†ng</span>. 
                 H·ªèi b·∫°n ${t} ƒë·ª©ng th·ª© m·∫•y?`,n=String(a)}else{const s=getRandomInt(15)+15,i=e[getRandomInt(e.length)];let a=getRandomInt(s-5)+2,c=getRandomInt(s-5)+2;for(;Math.abs(a-c)<2;)c=getRandomInt(s-5)+2;const u=Math.abs(a-c)-1;o=`M·ªôt h√†ng c√≥ <span class="text-purple-700 font-extrabold">${s}</span> ng∆∞·ªùi. 
                 B·∫°n <span class="text-purple-700 font-extrabold">${t}</span> ƒë·ª©ng th·ª© <span class="text-purple-700 font-extrabold">${a}</span>, 
                 b·∫°n <span class="text-purple-700 font-extrabold">${i}</span> ƒë·ª©ng th·ª© <span class="text-purple-700 font-extrabold">${c}</span>. 
                 H·ªèi gi·ªØa b·∫°n ${t} v√† b·∫°n ${i} c√≥ bao nhi√™u ng∆∞·ªùi?`,n=String(u)}return{question:o,answer:n,type:"input"}}function generateTIMOQuestion(){const e=QUESTION_TYPES_TIMO[getRandomInt(QUESTION_TYPES_TIMO.length)];return e==="day-of-week"?generateDayOfWeekQuestion():e==="age-problem"?generateAgeProblem():generateQueueProblem()}const supabaseUrl="https://jeycrlggnebcasbrfygr.supabase.co",supabaseKey="sb_publishable_No04r_35Hg-FG8xf--9Zvg_pyUZPtkl",supabase=window.supabase.createClient(supabaseUrl,supabaseKey);document.getElementById("submit-score").onclick=async()=>{const e=document.getElementById("player-name"),t=e.value.trim();if(!t){alert("Vui l√≤ng nh·∫≠p t√™n");return}const{error:r}=await supabase.from("leaderboard").insert([{name:t,score,level:quizState.currentLevel,final_score:window.finalScore}]);if(r){alert("L·ªói l∆∞u k·∫øt qu·∫£"),console.error(r);return}document.getElementById("name-modal").classList.add("hidden"),e.value="",loadLeaderboard()};async function loadLeaderboard(){const{data:e}=await supabase.from("leaderboard").select("*").order("final_score",{ascending:!1}).limit(10),t=document.getElementById("leaderboard-body");t.innerHTML="",e.forEach((r,o)=>{const n=o===0?"leader-top-1":o===1?"leader-top-2":o===2?"leader-top-3":"";t.innerHTML+=`
                <tr class="border-b ${n}">
                <td>${o+1}</td>
                <td>${r.name}</td>
                <td class="text-right">${r.final_score}</td>
                <td class="text-right">${r.level}</td>
                </tr>
            `})}const correctSound=document.getElementById("sound-correct"),wrongSound=document.getElementById("sound-wrong");function playCorrectSound(){correctSound.currentTime=0,correctSound.play()}function playWrongSound(){wrongSound.currentTime=0,wrongSound.play()}const QUESTION_TYPES_BASIC=["basic-op","find-x","sorting","comparison","balance-equation","create-even-odd","create-max-min","sequence-pattern","sequence-increment","shape-pattern"],QUESTION_TYPES_MULT_DIV=["mult-div","find-x-mult-div","sorting","comparison"],DAY_OF_WEEK_HINT=`
            <div class="flex flex-col sm:flex-row justify-center items-center text-center space-y-2 sm:space-y-0 sm:space-x-4 p-2">
                <span class="text-red-600 font-semibold text-xs md:text-sm text-right sm:text-left">H√¥m kia, H√¥m qua, Tr∆∞·ªõc ƒë√≥ l√† TR·ª™ (-)</span>
                <span class="text-lg font-extrabold text-blue-700 px-3 py-1 bg-white rounded-full shadow-lg border-2 border-blue-300">H√îM NAY</span>
                <span class="text-green-600 font-semibold text-xs md:text-sm text-left sm:text-right">Ng√†y mai, Ng√†y kia, Sau ƒë√≥ l√† C·ªòNG (+)</span>
            </div>
        `;document.addEventListener("DOMContentLoaded",()=>{document.getElementById("setup-screen"),document.getElementById("quiz-screen"),document.getElementById("end-screen");const e=document.querySelectorAll(".level-select-btn"),t=document.getElementById("start-quiz-btn");document.getElementById("next-question-btn"),document.getElementById("restart-quiz-btn"),document.getElementById("exit-quiz-btn"),document.getElementById("question-text"),document.getElementById("current-level-name"),document.getElementById("current-question-number"),document.getElementById("total-questions"),document.getElementById("current-score"),document.getElementById("final-score"),document.getElementById("math-answer-input"),document.getElementById("submit-answer-btn"),document.getElementById("message-box"),document.getElementById("input-answer-container"),document.getElementById("sorting-numbers-container"),document.getElementById("sorting-target-container"),document.getElementById("sorting-controls"),document.getElementById("reset-sorting-btn"),document.getElementById("submit-sorting-btn"),document.getElementById("progress-bar"),document.getElementById("score-effect"),document.getElementById("quiz-timer"),document.getElementById("time-taken-message"),document.getElementById("clock-image-container");const r=document.getElementById("level-description");e.forEach(o=>{o.addEventListener("click",()=>{quizState.currentLevel=parseInt(o.getAttribute("data-level")),quizState.currentLevelName=o.getAttribute("data-name"),quizState.currentQuizType=o.getAttribute("data-type"),e.forEach(n=>{n.classList.remove("bg-indigo-500","text-white","bg-green-500","bg-purple-500"),n.classList.add("bg-gray-200","text-gray-700")}),quizState.currentQuizType==="ADD_SUB"?o.classList.add("bg-indigo-500","text-white"):quizState.currentQuizType==="TIMO"?o.classList.add("bg-purple-500","text-white"):o.classList.add("bg-green-500","text-white"),o.classList.remove("bg-gray-200","text-gray-700"),t.disabled=!1,r.textContent=`B·∫°n ƒë√£ ch·ªçn: ${quizState.currentLevelName}`})})});const hintArea=document.getElementById("hint-area"),hintText=document.getElementById("hint-text"),comparisonDisplayArea=document.getElementById("comparison-display-area"),expressionLeft=document.getElementById("expression-left"),expressionRight=document.getElementById("expression-right"),comparisonBox=document.getElementById("comparison-box"),comparisonButtonsContainer=document.getElementById("comparison-buttons-container"),comparisonButtons=document.querySelectorAll(".comp-btn"),confirmModal=document.getElementById("confirm-modal"),modalCancelBtn=document.getElementById("modal-cancel-btn"),modalConfirmBtn=document.getElementById("modal-confirm-btn");function formatTime(e){const t=Math.floor(e/60),r=e%60;return`${String(t).padStart(2,"0")}:${String(r).padStart(2,"0")}`}function updateTimerDisplay(){quizTimerDisplay.textContent=formatTime(quizState.timeRemaining),quizState.timeRemaining<=60?(quizTimerDisplay.classList.add("text-4xl"),quizTimerDisplay.classList.remove("text-3xl")):(quizTimerDisplay.classList.add("text-3xl"),quizTimerDisplay.classList.remove("text-4xl"))}function startTimer(){quizState.startTime=Date.now(),quizState.timeRemaining=quizState.MAX_QUIZ_TIME_SECONDS,updateTimerDisplay(),quizState.quizTimer&&clearInterval(quizState.quizTimer),quizState.quizTimer=setInterval(()=>{quizState.timeRemaining--,updateTimerDisplay(),quizState.timeRemaining<=0&&(clearInterval(quizState.quizTimer),endQuiz(!0))},1e3)}function stopTimer(){quizState.quizTimer&&clearInterval(quizState.quizTimer),quizState.quizTimer=null}function showScoreEffect(e){scoreEffect.textContent=e?"+1":"0",scoreEffect.className=e?"score-effect text-yellow-500":"score-effect text-red-500",scoreEffect.style.opacity="0",scoreEffect.style.transform="translateY(0)",scoreEffect.offsetWidth,scoreEffect.style.opacity="1",scoreEffect.style.transform="translateY(-25px)",setTimeout(()=>{scoreEffect.style.opacity="0"},500)}function generateQuestion(){if(quizState.currentQuestionNumber>=quizState.TOTAL_QUIZ_QUESTIONS){endQuiz(!1);return}quizState.currentQuestionNumber++,currentQuestionNumberSpan.textContent=quizState.currentQuestionNumber;const e=quizState.currentQuestionNumber/quizState.TOTAL_QUIZ_QUESTIONS*100;progressBar.style.width=`${e}%`;let t,r=getMaxRange(quizState.currentLevel),o;if(quizState.currentQuizType==="MULT_DIV")o=QUESTION_TYPES_MULT_DIV;else if(quizState.currentQuizType==="TIMO"){quizState.currentQuestion=generateTIMOQuestion(),displayQuestion(quizState.currentQuestion);return}else o=QUESTION_TYPES_BASIC;if(quizState.currentQuestionNumber===quizState.TOTAL_QUIZ_QUESTIONS-1&&quizState.TOTAL_QUIZ_QUESTIONS>=2)quizState.currentQuestion=generateClockQuestion();else if(quizState.currentQuestionNumber===quizState.TOTAL_QUIZ_QUESTIONS)quizState.currentQuestion=generateWordProblem();else switch(t=o[getRandomInt(o.length)],t){case"balance-equation":quizState.currentQuestion=generateBalanceEquation(r);break;case"create-even-odd":quizState.currentQuestion=generateEvenOddNumberQuestion();break;case"create-max-min":quizState.currentQuestion=generateMaxMinTwoNumbers();break;case"sequence-pattern":quizState.currentQuestion=generateSequencePattern();break;case"sequence-increment":quizState.currentQuestion=generateSequenceIncrement();break;case"shape-pattern":quizState.currentQuestion=generateShapePattern();break;case"basic-op":quizState.currentQuestion=generateBasicOpQuestion(r);break;case"mult-div":quizState.currentQuestion=generateMultDivQuestion();break;case"find-x":quizState.currentQuestion=generateFindXQuestion(r);break;case"find-x-mult-div":quizState.currentQuestion=generateFindXMultDivQuestion();break;case"sorting":quizState.currentQuestion=generateSortingQuestion(quizState.currentLevel);break;case"comparison":quizState.currentQuestion=generateComparisonQuestion(quizState.currentLevel,quizState.currentQuizType);break;default:quizState.currentQuestion=generateBasicOpQuestion(10)}displayQuestion(quizState.currentQuestion)}function displayQuestion(e){messageBox.textContent="";const t=document.getElementById("clockImageContainer");if(t.innerHTML="",t.classList.add("hidden"),e.type==="clock"&&e.svg&&(t.innerHTML=e.svg,t.classList.remove("hidden")),nextQuestionBtn.classList.add("hidden"),inputAnswerContainer.classList.add("hidden"),sortingNumbersContainer.classList.add("hidden"),sortingTargetContainer.classList.add("hidden"),sortingControls.classList.add("hidden"),comparisonButtonsContainer.classList.add("hidden"),clockImageContainer.classList.add("hidden"),comparisonDisplayArea.classList.add("hidden"),questionText.classList.remove("hidden"),document.querySelectorAll(".choice-btn").forEach(o=>o.remove()),hintArea.classList.add("hidden"),hintText.innerHTML="",e.type==="input"?(questionText.innerHTML=e.question,inputAnswerContainer.classList.remove("hidden"),mathAnswerInput.value="",mathAnswerInput.focus(),submitAnswerBtn.onclick=checkMathAnswer,submitAnswerBtn.disabled=!1,e.special==="clock"&&clockImageContainer.classList.remove("hidden")):e.type==="sorting"?(questionText.innerHTML=e.question,sortingNumbersContainer.classList.remove("hidden"),sortingTargetContainer.classList.remove("hidden"),sortingControls.classList.remove("hidden"),renderSortingNumbers(e.numbers),sortingTargetContainer.innerHTML="",submitSortingBtn.onclick=checkSortingAnswer,submitSortingBtn.disabled=!1,resetSortingBtn.disabled=!1):e.type==="comparison"&&(questionText.innerHTML=e.question,questionText.classList.add("hidden"),comparisonDisplayArea.classList.remove("hidden"),comparisonButtonsContainer.classList.remove("hidden"),expressionLeft.textContent=e.exp1,expressionRight.textContent=e.exp2,comparisonBox.textContent="?",comparisonBox.classList.remove("correct-answer-box","incorrect-answer-box"),comparisonButtons.forEach(o=>o.disabled=!1)),e.type==="multiple-choice"){questionText.innerHTML=e.question;let o='<div id="choice-buttons-area" class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-4">';e.choices.forEach(s=>{o+=`<button class="choice-btn px-4 py-3 bg-purple-100 text-purple-800 font-semibold rounded-lg hover:bg-purple-200 transition duration-300 border-2 border-transparent" data-choice="${s}">${s}</button>`}),o+="</div>",questionText.innerHTML+=o,document.querySelectorAll(".choice-btn").forEach(s=>{s.addEventListener("click",()=>{checkMultipleChoiceAnswer(s.getAttribute("data-choice"))})}),e.special==="day-of-week"&&(hintArea.classList.remove("hidden"),hintText.innerHTML=DAY_OF_WEEK_HINT)}}function renderSortingNumbers(e){sortingNumbersContainer.innerHTML="",e.forEach(t=>{const r=document.createElement("div");r.className="sorting-number px-4 py-2 bg-white border border-gray-300 rounded-lg text-2xl font-semibold text-gray-800 shadow-sm",r.textContent=t,r.setAttribute("data-value",t),r.addEventListener("click",()=>handleNumberClick(r)),sortingNumbersContainer.appendChild(r)})}function handleNumberClick(e){submitSortingBtn.disabled||(e.classList.contains("selected")?(e.classList.remove("selected"),sortingNumbersContainer.appendChild(e)):(e.classList.add("selected"),sortingTargetContainer.appendChild(e)))}function processAnswerResult(e,t){e?(quizState.currentScore++,quizState.currentQuestion.type==="input"?messageBox.innerHTML=`üéâ <span class="text-green-800">Ch√≠nh x√°c!</span> ƒê√°p √°n l√†: <span class="text-green-600 font-extrabold">${t}</span>`:quizState.currentQuestion.type==="comparison"?(messageBox.innerHTML=`üéâ <span class="text-green-800">Ch√≠nh x√°c!</span> ${t}`,comparisonBox.classList.add("correct-answer-box")):quizState.currentQuestion.type==="multiple-choice"?messageBox.innerHTML=`üéâ <span class="text-green-800">Ch√≠nh x√°c!</span> ƒê√°p √°n l√†: ${t}`:messageBox.innerHTML=`üéâ <span class="text-green-800">Ch√≠nh x√°c!</span> Th·ª© t·ª± ƒë√∫ng l√†: ${t}`,messageBox.className="mt-4 text-xl font-bold text-green-800 p-3 rounded-lg correct-answer-box min-h-[30px]",showScoreEffect(!0),playCorrectSound()):(quizState.currentQuestion.type==="comparison"?messageBox.innerHTML=`‚ùå <span class="text-red-800">Sai r·ªìi!</span> ${t}`:quizState.currentQuestion.type==="multiple-choice"?messageBox.innerHTML=`‚ùå <span class="text-red-800">Sai r·ªìi!</span> ƒê√°p √°n ƒë√∫ng l√†: ${t}`:messageBox.innerHTML=`‚ùå <span class="text-red-800">Sai r·ªìi!</span> ƒê√°p √°n ƒë√∫ng l√†: <span class="text-red-600 font-extrabold">${t}</span>`,messageBox.className="mt-4 text-xl font-bold text-red-800 p-3 rounded-lg incorrect-answer-box min-h-[30px]",showScoreEffect(!1),playWrongSound(),quizState.currentQuestion.type==="comparison"&&comparisonBox.classList.add("incorrect-answer-box")),currentScoreSpan.textContent=quizState.currentScore,nextQuestionBtn.classList.remove("hidden")}function checkMathAnswer(){const e=mathAnswerInput.value.trim(),t=quizState.currentQuestion.answer;if(e===""){messageBox.textContent="Vui l√≤ng nh·∫≠p ƒë√°p √°n!",messageBox.className="mt-4 text-xl font-bold text-yellow-800 p-3 rounded-lg warning-answer-box min-h-[30px]";return}submitAnswerBtn.disabled=!0,processAnswerResult(e===t,t)}function checkSortingAnswer(){const e=Array.from(sortingTargetContainer.children),t=e.map(s=>s.getAttribute("data-value")).join(","),r=quizState.currentQuestion.answer,o=t===r;submitSortingBtn.disabled=!0,resetSortingBtn.disabled=!0;const n=r.split(",").join(' <span class="text-indigo-600 font-extrabold">‚Üí</span> ');if(o)e.forEach(s=>{s.classList.remove("selected"),s.classList.add("bg-green-200","text-green-800"),s.removeEventListener("click",handleNumberClick)});else{const i=`Th·ª© t·ª± b·∫°n ch·ªçn l√†: ${t.split(",").join(" ‚Üí ")}. ƒê√∫ng ph·∫£i l√†: ${n}`;processAnswerResult(!1,i);return}processAnswerResult(o,n)}function checkComparisonAnswer(e){comparisonButtons.forEach(o=>o.disabled=!0);const t=e===quizState.currentQuestion.answer,r=`(${quizState.currentQuestion.exp1} = <span class="text-indigo-600 font-extrabold">${quizState.currentQuestion.result1}</span>) ${quizState.currentQuestion.answer} (${quizState.currentQuestion.exp2} = <span class="text-indigo-600 font-extrabold">${quizState.currentQuestion.result2}</span>).`;comparisonBox.textContent=e,processAnswerResult(t,r)}function checkMultipleChoiceAnswer(e){const t=document.querySelectorAll(".choice-btn");t.forEach(n=>{n.disabled=!0,n.getAttribute("data-choice")===e&&n.classList.add("bg-purple-500","text-white","border-purple-700")});const r=e===quizState.currentQuestion.answer,o=`<span class="text-purple-600 font-extrabold">${quizState.currentQuestion.answer}</span>`;t.forEach(n=>{n.getAttribute("data-choice")===quizState.currentQuestion.answer&&(n.classList.add("bg-green-500","text-white","border-green-700"),n.classList.remove("bg-purple-500","bg-purple-100"))}),processAnswerResult(r,o)}function getBonusByLevel(e){return e===2?5:e===3?10:0}function endQuiz(e){stopTimer(),finalScoreSpan.textContent=quizState.currentScore;const t=getBonusByLevel(quizState.currentLevel);window.finalScore=quizState.currentScore+t,quizScreen.classList.add("hidden"),endScreen.classList.remove("hidden");const r=document.getElementById("name-modal");if(r.classList.remove("hidden"),r.classList.add("flex"),document.getElementById("total-questions-display").textContent=quizState.TOTAL_QUIZ_QUESTIONS,e)timeTakenMessage.textContent="H·∫øt gi·ªù! Quiz ƒë√£ k·∫øt th√∫c.";else{const o=quizState.MAX_QUIZ_TIME_SECONDS-quizState.timeRemaining,n=formatTime(o);timeTakenMessage.textContent=`B·∫°n ƒë√£ ho√†n th√†nh trong ${n}.`}}function showModal(){stopTimer(),confirmModal.classList.remove("hidden")}function hideModal(){confirmModal.classList.add("hidden"),quizScreen.classList.contains("hidden")===!1&&startTimer()}function exitToSetupScreen(){stopTimer(),hideModal(),quizScreen.classList.add("hidden"),setupScreen.classList.remove("hidden"),levelSelectBtns[0].click()}startQuizBtn.addEventListener("click",()=>{quizState.currentLevel&&(quizState.currentScore=0,quizState.currentQuestionNumber=0,currentScoreSpan.textContent=0,totalQuestionsSpan.textContent=quizState.TOTAL_QUIZ_QUESTIONS,currentLevelNameSpan.textContent=quizState.currentLevelName,setupScreen.classList.add("hidden"),endScreen.classList.add("hidden"),quizScreen.classList.remove("hidden"),startTimer(),generateQuestion())});restartQuizBtn.addEventListener("click",()=>{quizState.currentScore=0,quizState.currentQuestionNumber=0,quizState.timeRemaining=quizState.MAX_QUIZ_TIME_SECONDS,endScreen.classList.add("hidden"),setupScreen.classList.remove("hidden"),currentScoreSpan.textContent=0,progressBar.style.width="0%",messageBox.textContent="",levelSelectBtns[0].click();const e=document.querySelectorAll(".q-count-btn");e.forEach(t=>{t.classList.remove("bg-indigo-500","text-white"),t.classList.add("bg-gray-200","text-gray-700")}),e[1].classList.add("bg-indigo-500","text-white"),e[1].classList.remove("bg-gray-200","text-gray-700"),quizState.TOTAL_QUIZ_QUESTIONS=20});nextQuestionBtn.addEventListener("click",()=>{generateQuestion()});mathAnswerInput.addEventListener("keypress",e=>{e.key==="Enter"&&!submitAnswerBtn.disabled?checkMathAnswer():e.key==="Enter"&&nextQuestionBtn.classList.contains("hidden")===!1&&nextQuestionBtn.click()});comparisonButtons.forEach(e=>{e.addEventListener("click",()=>{checkComparisonAnswer(e.getAttribute("data-op"))})});resetSortingBtn.addEventListener("click",()=>{Array.from(sortingTargetContainer.children).forEach(e=>{e.classList.remove("selected"),sortingNumbersContainer.appendChild(e)})});exitQuizBtn.addEventListener("click",showModal);modalCancelBtn.addEventListener("click",hideModal);modalConfirmBtn.addEventListener("click",exitToSetupScreen);document.addEventListener("DOMContentLoaded",()=>{levelSelectBtns[0].click(),startQuizBtn.disabled=!1;const e=document.querySelectorAll(".q-count-btn");e.forEach(t=>{t.addEventListener("click",()=>{quizState.TOTAL_QUIZ_QUESTIONS=parseInt(t.getAttribute("data-questions")),e.forEach(r=>{r.classList.remove("bg-indigo-500","text-white"),r.classList.add("bg-gray-200","text-gray-700")}),t.classList.add("bg-indigo-500","text-white"),t.classList.remove("bg-gray-200","text-gray-700")})})});loadLeaderboard();
